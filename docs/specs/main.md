# Minecraft Pixel Art Generator - Feature Spec

## 概覽

純前端網頁工具，讓使用者上傳圖片後，自動將圖片轉換為 Minecraft 方塊點陣圖，並以等角 3D 視圖呈現結果。

## 技術棧

- **框架**：Vue 3 (Composition API, `<script setup>`)
- **語言**：TypeScript（strict mode）
- **建構工具**：Vite
- **樣式**：Tailwind CSS
- **3D 渲染**：Three.js（等角視圖）
- **圖片處理**：Canvas API（純前端，無後端）
- **測試**：Vitest
- **部署**：GitHub Pages

---

## 頁面佈局

```
┌─────────────────────────────────────────────┐
│  Minecraft Pixel Art Generator              │
├─────────────┬───────────────────────────────┤
│  設定面板    │  預覽區域                      │
│  ---------- │  ┌──────────┐ ┌─────────────┐ │
│  1. 上傳圖片 │  │  原圖    │ │ 等角3D預覽  │ │
│  2. 解析度   │  └──────────┘ └─────────────┘ │
│  3. 方塊調色 │                               │
│     盤選擇   │  方塊用量統計                  │
│  [轉換] btn  │                               │
└─────────────┴───────────────────────────────┘
```

---

## 功能模組

### 模組 1：圖片上傳

- 拖放或點擊上傳，支援 PNG、JPG、GIF
- **透明度處理**：若圖片為帶 alpha 通道的 PNG，透明像素（alpha < 128）不產生方塊
- 不做主動去背；使用者需自行去背後上傳
- 上傳後顯示原始圖片預覽

### 模組 2：解析度設定

- 預設選項：32、64、128（格寬）
- 自由輸入寬度（16–256），高度自動等比計算
- 顯示最終方塊數量（例：「64 × 36 格 = 2,304 個方塊」）

### 模組 3：方塊調色盤

分類預設組合，可個別展開/收合：

| 分類 | 內容 |
|------|------|
| 全彩羊毛 | 16 種顏色羊毛 |
| 混凝土 | 16 種顏色混凝土 |
| 木頭類 | 橡木、白樺、雲杉、叢林、金合歡、深色橡木原木 |
| 石材類 | 石頭、圓石、安山岩、閃長岩、花崗岩、石磚等 |
| 混合常用 | 以上全選 |

- 每個分類可個別展開，逐一勾選/取消方塊
- 至少需選 1 個方塊才能執行轉換

### 模組 4：轉換引擎

1. 用 Canvas API 將原圖縮放到目標解析度
2. 讀取每個像素的 RGBA 值
3. 若 alpha < 128，跳過（不產生方塊）
4. 其餘像素使用 **CIE Lab Delta E** 計算與所有已選方塊顏色的感知距離，取最近者
5. 選用性：執行**減少雜點**後處理（預設啟用）
6. 輸出結果格式：`Array<{ x: number, y: number, blockId: string }>`

**顏色距離演算法：CIE Lab Delta E（CIE76）**：
```
sRGB → Linear RGB → XYZ → CIE Lab
ΔE = √((L1-L2)² + (a1-a2)² + (b1-b2)²)
```
> 採用 CIE Lab 色彩空間而非 RGB Euclidean 距離，因為後者無法反映人眼感知，
> 容易將橘色誤判為黃色等視覺上明顯有差異的顏色。

### 模組 4a：減少雜點（Noise Reduction）

在顏色比對完成後，執行 4-directional 鄰居過濾：

- 偵測周圍四個方向（上下左右）均無相同方塊顏色的孤立方塊
- 將孤立方塊替換為其鄰居中出現最多次的方塊顏色
- 預設**啟用**，可透過 UI 核取方塊切換開關
- 有效消除點陣圖中的單點雜色雜訊

### 模組 5：Three.js 等角預覽

- 使用 Three.js 渲染等角（Isometric）視角
- 每個方塊繪製為帶三面（上、左、右）的等角立方體
- 三面以相同基礎色加上明暗差異呈現立體感：
  - 上面：100% 亮度
  - 左面：75% 亮度
  - 右面：85% 亮度
- 互動：滑鼠拖曳旋轉、滾輪縮放
- Hover 方塊顯示 tooltip（方塊名稱 + 座標）

### 模組 6：方塊用量統計

- 統計每種方塊使用數量，依數量降序排列
- 顯示格式：`[方塊色塊] 白色羊毛 ×142`
- 提供「複製清單」按鈕（複製純文字清單）

---

## 資料格式

### 方塊定義

```ts
interface Block {
  id: string        // e.g. "white_wool"
  name: string      // e.g. "白色羊毛"
  nameEn: string    // e.g. "White Wool"
  category: string  // "wool" | "concrete" | "wood" | "stone"
  color: { r: number; g: number; b: number }
}
```

### 轉換結果

```ts
interface PixelBlock {
  x: number
  y: number
  blockId: string
}
```

---

## 測試範圍

- **顏色比對**：CIE Lab Delta E 演算法正確性，邊界值測試，橘色/黃色不誤判
- **透明度處理**：alpha < 128 的像素被正確跳過
- **解析度計算**：等比縮放的寬高計算
- **方塊調色盤**：過濾邏輯、至少選一個的驗證
- **用量統計**：計算與排序正確性
- **減少雜點**：孤立方塊正確被偵測並替換，邊緣方塊處理正確
